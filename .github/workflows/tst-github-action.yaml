name: Test manual action run
on:
  workflow_dispatch:
    inputs:
      environment:
        description: "Environment under test"
        required: true
        default: "prod"
        type: choice
        options: ["prod"]

jobs:
  matrix-prep:
    name: Print the input
    runs-on: ubuntu-latest
    steps:
      - name: Fetch env specific params
        id: matrix-val
        run: |
          # echo "${{ secrets.TEST_SECRET_1 }}" | jq '.'
          matrix_val=$(echo "${{ secrets.TEST_SECRET_1 }}" | jq '."${{ inputs.environment }}"')
          echo $matrix_val
          echo ::set-output name=matrix::$(echo $matrix_val)
      - name: Print env specific params
        run: |
          echo ${{ steps.matrix-val.outputs.matrix}}
  loop-matrix:
    needs: matrix-prep
    runs-on: ubuntu-latest
    strategy:
      matrix: ${{ fromJson(needs.matrix_prep.outputs.matrix) }}
    steps:
      - name: print-vals
        run: |
          echo "${{ matrix.datacenter }}"
