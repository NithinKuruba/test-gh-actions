name: Test manual action run
on:
  workflow_dispatch:
    inputs:
      environment:
        description: "Environment under test"
        required: true
        default: "prod"
        type: choice
        options: ["prod"]

jobs:
  matrix-prep:
    name: Print the input
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.set-matrix.outputs.matrix }}
    steps:
      - name: Fetch env specific params
        id: set-matrix
        run: |
          # echo "${{ secrets.TEST_SECRET_1 }}" | jq '.'
          matrix_val=$(echo "${{ secrets.TEST_SECRET_1 }}" | jq '."${{ inputs.environment }}"')
          echo $matrix_val
          echo ::set-output name=matrix::{\"include\":$(echo $matrix)}
      - name: Print env specific params
        run: |
          echo ${{ steps.set-matrix.outputs.matrix}}
  loop-matrix:
    needs: matrix-prep
    runs-on: ubuntu-latest
    steps:
      - name: print-vals
        run: |
          echo "${{ needs.matrix-prep.outputs.matrix }}"
